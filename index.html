<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple WebGIS ó Provinces</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-sA+e2o1h5g9Qd4u3mZ0J3q8Q+Q0b0q4kH2f3kZ6kD3I="
    crossorigin=""/>

  <style>
    html,body,#map { height:100%; margin:0; padding:0; }
    body { direction: rtl; font-family: "Tahoma", sans-serif; }
    #app {
      display: grid;
      grid-template-columns: 1fr 350px;
      height: 100vh;
    }
    #map {
      border-left: 1px solid #ddd;
    }
    #panel {
      padding: 12px;
      box-sizing: border-box;
      background: #f7f7f7;
      overflow:auto;
    }
    .info-title { font-weight:700; margin-bottom:8px; }
    .prop { margin:6px 0; }
    .btn { display:inline-block; padding:6px 10px; border-radius:6px; background:#2b7cff; color:white; text-decoration:none; cursor:pointer; }
    /* default style for provinces */
    .province-style {
      color: #333;
      weight: 1;
      fillOpacity: 0.4;
    }
    /* highlight */
    .highlight {
      color: #ff6600 !important;
      weight: 3 !important;
      fillOpacity: 0.6 !important;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="map"></div>
    <div id="panel">
      <div class="info-title">«ÿ·«⁄«  «” «‰</div>
      <div id="info">»—«? „‘«ÂœÂ? «ÿ·«⁄« ° —Ê? ?ò «” «‰ ò·?ò ò‰?œ.</div>
      <hr />
      <div style="margin-top:8px;">
        <button id="zoomAll" class="btn">‰„«?‘ ò· ò‘Ê—</button>
        <button id="resetHighlight" class="btn" style="background:#777;margin-right:6px;">—?”  «‰ Œ«»</button>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-QVqDo3VY0qvTqJ9VQ+1t5xQfA0wFJ0p3V4c6z0u6+gM="
    crossorigin=""></script>

  <script>
    // ”«Œ  ‰ﬁ‘Â »œÊ‰ ·«?Â? Å”ù“„?‰Â
    const map = L.map('map', {
      worldCopyJump: true,
      zoomControl: true
    });

    // «ê— ŒÊ«” ?œ ‰ﬁ‘Â —« œ— ?ò „ÕœÊœÂ? „‰«”» ﬁ—«— œÂ?œ° »⁄œ «“ »«—ê–«—? GeoJSON «“ fitBounds «” ›«œÂ „?ùò‰?„.

    let geojsonLayer = null;
    let lastSelected = null;

    // «” «?· «” «‰œ«—œ »—«? ›?ç—Â«
    function style(feature) {
      return {
        color: '#2a6f9e',
        weight: 1,
        fillOpacity: 0.35
      };
    }

    // Êﬁ ? —Ê? ›?ç— ò·?ò ‘œ
    function onEachFeature(feature, layer) {
      layer.on({
        click: (e) => {
          selectFeature(e.target, feature);
        },
        mouseover: (e) => {
          e.target.setStyle({ weight:2, fillOpacity:0.45 });
        },
        mouseout: (e) => {
          // «ê— «?‰ ›?ç— «‰ Œ«» ‰‘œÂ »«‘œ° «” «?· —« —?”  ò‰
          if (!e.target.classList || !e.target.classList.contains('selected')) {
            geojsonLayer.resetStyle(e.target);
          }
        }
      });
    }

    function selectFeature(layer, feature) {
      // —?”  «‰ Œ«» ﬁ»·?
      if (lastSelected && lastSelected !== layer) {
        lastSelected.setStyle(style(lastSelected.feature));
        if (lastSelected.classList) lastSelected.classList.remove('selected');
      }
      // «⁄„«· Â«?·«? 
      layer.setStyle({ color:'#ff6600', weight:3, fillOpacity:0.6 });
      if (layer.classList) layer.classList.add('selected');
      lastSelected = layer;

      // ‰„«?‘ «ÿ·«⁄«  œ— Å‰· ò‰«—
      const info = document.getElementById('info');
      // «“ Å—«Å— ?ùÂ«? „ÊÃÊœ «” ›«œÂ ò‰: „⁄„Ê·« feature.properties.name Ê feature.properties.id „ÊÃÊœ «” 
      const name = feature.properties && feature.properties.name ? feature.properties.name : '‰«„ ‰œ«—œ';
      const id = feature.properties && feature.properties.id ? feature.properties.id : '‘‰«”Â ‰œ«—œ';
      info.innerHTML = `
        <div class="prop"><strong>‰«„:</strong> ${name}</div>
        <div class="prop"><strong>òœ (id):</strong> ${id}</div>
        <div class="prop"><strong>Å—«Å— ?ùÂ« ( „«„):</strong><pre style="white-space:pre-wrap;">${JSON.stringify(feature.properties, null, 2)}</pre></div>
      `;

      // “Ê„ ò—œ‰ »Â „ÕœÊœÂ? ›?ç—
      try {
        map.fitBounds(layer.getBounds(), { maxZoom: 8, padding: [20,20] });
      } catch(e){ /* »⁄÷? ›?ç—Â« MultiPolygon Ê ... „„ò‰ «”  ‰?«“ »Â Â‰œ· Œ«’ œ«‘ Â »«‘‰œ */ }
    }

    // »«—ê–«—? GeoJSON „Õ·?
    fetch('ir.json')
      .then(resp => {
        if (!resp.ok) throw new Error('Œÿ« œ— »«—ê–«—? ir.json ó „ÿ„∆‰ ‘Ê?œ ›«?· ò‰«— index.html «”  Ê ”—Ê— „Õ·? «Ã—« ‘œÂ «” .');
        return resp.json();
      })
      .then(data => {
        geojsonLayer = L.geoJSON(data, {
          style: style,
          onEachFeature: onEachFeature
        }).addTo(map);

        // «ê— »œÊ‰ ·«?Â Å”ù“„?‰Â Â” ?„° »«?œ ?ò view „⁄ﬁÊ·  ‰Ÿ?„ ò‰?„:
        map.fitBounds(geojsonLayer.getBounds(), { padding: [20,20] });
      })
      .catch(err => {
        document.getElementById('info').innerText = 'Œÿ« Â‰ê«„ »«—ê–«—? GeoJSON: ' + err.message;
        console.error(err);
      });

    // œò„ÂùÂ«
    document.getElementById('zoomAll').addEventListener('click', () => {
      if (geojsonLayer) map.fitBounds(geojsonLayer.getBounds(), { padding:[20,20] });
    });
    document.getElementById('resetHighlight').addEventListener('click', () => {
      if (lastSelected) {
        geojsonLayer.resetStyle(lastSelected);
        if (lastSelected.classList) lastSelected.classList.remove('selected');
        lastSelected = null;
        document.getElementById('info').innerText = '»—«? „‘«ÂœÂ? «ÿ·«⁄« ° —Ê? ?ò «” «‰ ò·?ò ò‰?œ.';
      }
    });
  </script>
</body>
</html>